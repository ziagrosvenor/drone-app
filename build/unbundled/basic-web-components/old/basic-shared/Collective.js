!function(){function t(){this.aspects=[],this.methods={},this.getters={},this.setters={},this.assimilate.apply(this,arguments)}t.prototype={assimilate:function(){var e,i=!1;for(var s in arguments){var n=arguments[s];e=n instanceof t?this._assimilateCollective(n):n.collective?this._assimilateCollective(n.collective):"function"==typeof n?this._assimilateAspect(new n):this._assimilateAspect(n),i=i||e}i&&this.invokeMethod("collectiveChanged")},innerAspect:function(t){var e=this.aspects.indexOf(t),i=e+1;return i<this.aspects.length?this.aspects[i]:null},get innermost(){return this.aspects[this.aspects.length-1]},get innermostAttached(){var t=this.aspects;for(i=t.length-1;i>=0;i--)if(t[i].parentNode)return t[i];return null},get innermostElement(){var t=this.aspects;for(i=t.length-1;i>=0;i--)if(t[i]instanceof HTMLElement)return t[i];return null},invokeGetter:function(t){var e=this.getters[t];if(!(null==e||e.length<1)){var i=e[0],s=i();return s}},invokeMethod:function(){var t=[].slice.call(arguments),e=t.shift(1);return this._invokeImplementations(this.methods[e],t)},invokeSetter:function(t,e){return this._invokeImplementations(this.setters[t],[e])},outerAspect:function(t){var e=this.aspects.indexOf(t),i=e-1;return i>=0?this.aspects[i]:null},get outermost(){return this.aspects[0]},get outermostAttached(){var t=this.aspects;for(i=0,length=t.length;i<length;i++)if(t[i].parentNode)return t[i];return null},get outermostElement(){var t=this.aspects;for(i=0,length=t.length;i<length;i++)if(t[i]instanceof HTMLElement)return t[i];return null},_addCollectiveGetter:function(t){var e=this.getters[t],i=e[0];Object.defineProperty(this,t,{configurable:!0,get:i})},_addCollectiveMethod:function(t){var e=this.methods[t].filter(function(t){return!this._isDefaultMethod(t)}.bind(this));this[t]=1===e.length?e[0]:this.invokeMethod.bind(this,t)},_addCollectiveSetter:function(t){var e=this.setters[t],i=1===e.length?e[0]:this.invokeSetter.bind(this,t);Object.defineProperty(this,t,{configurable:!0,set:i})},_addMembers:function(t,e){for(var i in e){var s=t[i]||[];t[i]=s.concat(e[i])}},_aspectWithName:function(t){var e=this.aspects;for(i=0,length=e.length;i<length;i++)if(e[i].name===t)return e[i];return null},_assimilateAspect:function(t){if(t.collective===this)return!1;if(t.name&&this._aspectWithName(t.name))return!1;var e=this._getContributedMembers(t);return this._addMembers(this.methods,e.methods),this._addMembers(this.getters,e.getters),this._addMembers(this.setters,e.setters),this._exposeCollectiveMembers(e),this.aspects.push(t),t.collective=this,!0},_assimilateCollective:function(t){return t!==this&&(t.aspects.forEach(function(t){this._assimilateAspect(t)}.bind(this)),t.aspects=[],!0)},_exposeCollectiveMembers:function(t){for(var e in t.methods)this._addCollectiveMethod(e);for(var i in t.getters)this._addCollectiveGetter(i);for(var s in t.setters)this._addCollectiveSetter(s)},_invokeImplementations:function(t,e){if(t){var i=e&&e.length>0;if(i)var s=[null].concat(e);for(var n,r=t.length,o=r-1;o>=0;o--){var c=t[o];i&&(c=Function.prototype.bind.apply(c,s)),n=c()}return n}},_getContributedMembers:function(t){var e=t.contribute||{},i={},s={},n={};return Object.getOwnPropertyNames(e).forEach(function(r){var o,c=Object.getOwnPropertyDescriptor(e,r);"function"==typeof c.value&&(o=this._isDefaultMethod(c.value)?c.value:c.value.bind(t),i[r]=i[r]||[],i[r].push(o)),"function"==typeof c.get&&(o=c.get.bind(t),s[r]=s[r]||[],s[r].push(o)),"function"==typeof c.set&&(o=c.set.bind(t),n[r]=n[r]||[],n[r].push(o))}.bind(this)),{methods:i,getters:s,setters:n}},_isDefaultMethod:function(t){return!!t._isDefaultMethod}},t.defaultMethod=function(){},t.defaultMethod._isDefaultMethod=!0,window.Basic=window.Basic||{},window.Basic.Collective=t}();