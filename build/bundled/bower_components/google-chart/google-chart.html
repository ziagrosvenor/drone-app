<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-request.html">
<link rel="import" href="../promise-polyfill/promise-polyfill-lite.html">
<link rel="import" href="charts-loader.html">


</head><body><dom-module id="google-chart">
  <link rel="import" type="css" href="google-chart.css">
  <template>
    <div id="chartdiv"></div>
  </template>
</dom-module>

<script>!function(){"use strict";var t="corechart",e=function(t,e){return function(n){return i(e).then(t).then(function(t){return new t(n)})}},n={area:e(function(t){return t.AreaChart}),bar:e(function(t){return t.BarChart}),bubble:e(function(t){return t.BubbleChart}),candlestick:e(function(t){return t.CandlestickChart}),column:e(function(t){return t.ColumnChart}),combo:e(function(t){return t.ComboChart}),geo:e(function(t){return t.GeoChart}),histogram:e(function(t){return t.Histogram}),line:e(function(t){return t.LineChart}),pie:e(function(t){return t.PieChart}),scatter:e(function(t){return t.ScatterChart}),"stepped-area":e(function(t){return t.SteppedAreaChart}),table:e(function(t){return t.Table},"table"),timeline:e(function(t){return t.Timeline},"timeline"),gauge:e(function(t){return t.Gauge},"gauge"),treemap:e(function(t){return t.TreeMap},"treemap")},r={},i=function(e){var n=e||t;return r[n]?r[n]:(r[n]=new Promise(function(t){google.charts.load("current",{packages:[n]}),google.charts.setOnLoadCallback(function(){t(google.visualization)})}),r[n])},a=function(t,e){return n[t](e)},o=i();Polymer({is:"google-chart",properties:{type:{type:String,value:"column",observer:"_typeChanged"},options:{type:Object,observer:"drawChart"},pkg:{type:Object,value:o,readOnly:!0},cols:{type:Array,observer:"_rowsOrColumnsChanged"},rows:{type:Array,observer:"_rowsOrColumnsChanged"},data:{type:Object,observer:"_dataChanged"},view:{type:Object,observer:"_viewChanged"},selection:{type:Array,notify:!0,observer:"_setSelection"}},observers:[],_chartObject:null,_chart:null,_dataView:null,_chartDrawn:null,_selection:null,_typeChanged:function(){this._chart=a(this.type,this.$.chartdiv).then(this._setupChart.bind(this)),this.drawChart()},_setSelection:function(){this.selection&&this.selection!==this._selection&&this._chartDrawn&&(this._selection=this.selection,this._chartDrawn.then(function(t){t.setSelection&&t.setSelection(this.selection)}.bind(this)))},_setupChart:function(t){return t.getSelection&&google.visualization.events.addListener(t,"select",function(){this.selection=this._selection=t.getSelection(),this.fire("google-chart-select",{selection:this.selection})}.bind(this)),this._chartObject=t,this._selection=null,t},drawChart:function(){this._chart&&this._dataView&&(this._chartDrawn=Promise.all([this._chart,this._dataView]).then(function(t){var e=t[0],n=t[1];return google.visualization.events.addOneTimeListener(e,"ready",function(){this.fire("google-chart-render")}.bind(this)),e.draw(n,this.options||{}),e}.bind(this),function(t){throw this.$.chartdiv.innerHTML=t,t}.bind(this)),this._setSelection())},getImageURI:function(){return this._chartObject.getImageURI()},_viewChanged:function(){this.view&&(this._dataView=Promise.resolve(this.view),this.drawChart())},_rowsOrColumnsChanged:function(){var t=this.rows,e=this.cols;t&&e&&(this._dataView=o.then(function(n){for(var r=new n.DataTable,i=0;i<e.length;i++)r.addColumn(e[i]);return r.addRows(t),new n.DataView(r)}),this.drawChart())},_dataChanged:function(){var t=this.data;if(t){var e;if("string"==typeof t||t instanceof String){var n=document.createElement("iron-request");e=n.send({url:t,handleAs:"json"}).then(function(t){return t.response})}else e=Promise.resolve(t);t.getNumberOfRows||(e=Promise.all([o,e]).then(function(e){var n=e[0];return t=e[1],t.rows&&t.cols?new n.DataTable(t):t.length>0?n.arrayToDataTable(t):0===t.length?Promise.reject("Data was empty."):Promise.reject("Data format was not recognized.")})),this._dataView=e.then(function(t){return new google.visualization.DataView(t)}),this.drawChart()}}})}();</script>
</body></html>